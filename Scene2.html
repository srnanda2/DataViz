<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>2 Column - fw-21-2-col</title>
<meta http-equiv="Content-Type" content="text/html; charset="utf-8"" />
<link rel="stylesheet" type="text/css" href="styles.css" />
  <!-- Load d3.js -->
<script src="https://d3js.org/d3.v4.js"></script>
</head>
<body>
<!-- Begin Wrapper -->
<div id="wrapper">
  <!-- Begin Faux -->
  <div id="faux">
    <!-- Begin Left Column -->
    <div id="leftcolumn">
      <h3>Evolution of Global GDP Rankings</h3>
      <br>
      <h5>How have the higher emitting countries ranked in terms of GDP growth in past years?</h5>
      <br>
       <p>Move the slider below to see evolution</p>
      <br>
      <div class="slider-container">
      <label for="slider">Year:</label>
      <div class="slider"></div>
      <div class="slider-value"></div>
      </div>
      <svg id="visualization" width="600" height="30"></svg>
      <div class="left-subcolumn">
      <div id="my_dataviz"></div>
  </div>
    </div>

    <!-- End Left Column -->
    <!-- Begin Right Column -->
    <div id="rightcolumn">
      <p style="margin:8px 0;">Nullaet ligula ut ant elit sed condiment elit quis urna laoreet. Fringpor aliquam justo dui nec morbi sed diculis ipsum elit temportis. Ultrisiacus ut curabitae orci nulla curabitur leo nunc lor sapien ligula. Diamquis sagittitor quat vitae leo ipsum id vivamus sodalesuada por gravida. Sedet rutrum pellus tellus vel nonummy tincidunt urna purus malestibulum adipis.</p>
      <ul style="margin:0 0 15px 0; padding:0; list-style-type:none;">
        <li style="margin-right:15px; display:inline;"><a href="#">Free CSS Templates</a></li>
        <li style="margin-right:15px; display:inline;"><a href="#">Code Sucks</a></li>
      </ul>
        <a href="index.html">
    <button class="next-button">Previous</button>
  </a>
        <a href="Scene3.html">
    <button class="next-button">Next</button>
  </a>

    </div>
    <!-- End Right Column -->
    <div class="clear"> </div>
  </div>
  <!-- End Faux -->
</div>
<!-- End Wrapper -->
</body>

<script>


// set the dimensions and margins of the graph
var margin = {top: 30, right: 30, bottom: 70, left: 60},
    width = 400 - margin.left - margin.right,
    height = 400 - margin.top - margin.bottom;

// append the svg object to the body of the page
var svg = d3.select("#my_dataviz")
  .append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform",
          "translate(" + margin.left + "," + margin.top + ")");

// Initialize the X axis
var x = d3.scaleBand()
  .range([ 0, width ])
  .padding(0.2);
var xAxis = svg.append("g")
  .attr("transform", "translate(0," + height + ")")

// Initialize the Y axis
var y = d3.scaleLinear()
  .range([ height, 0]);
var yAxis = svg.append("g")
  .attr("class", "myYaxis")


// A function that create / update the plot for a given variable:
function update(selectedVar) {

  // Parse the Data
  d3.csv("https://raw.githubusercontent.com/srnanda2/DataViz/main/WDI_GDP.csv", function(data) {
// Sort the data based on the selectedVar field
    data.sort(function(a, b) {
      return d3.descending(+a[selectedVar], +b[selectedVar]);
    });

    // X axis
    x.domain(data.map(function(d) { return d.Country; }))
    xAxis.transition().duration(1000).call(d3.axisBottom(x))

    // Add Y axis
    y.domain([d3.min(data, function(d) { return +d[selectedVar] })-5, d3.max(data, function(d) { return +d[selectedVar] }) ]);
    yAxis.transition().duration(1000).call(d3.axisLeft(y));

     // Add X axis label:
   svg.append("text")
  .attr("text-anchor", "end")
  .attr("x", width)
  .attr("y", height + margin.top + 20)
  .text("Countries with High CO2 Emissions")
  .attr("class", "axis-label");

   // Y axis label:
    svg.append("text")
  .attr("text-anchor", "end")
  .attr("transform", "rotate(-90)")
  .attr("y", -margin.left + 20)
  .attr("x", -margin.top)
  .text("Annual GDP Growth %")
  .attr("class", "axis-label");



    // Color scale: give me an income group name, I return a color
  var color = d3.scaleOrdinal()
    .domain(["Lower middle income", "Upper middle income", "High income"  ])
    .range([ "#402D54", "#D18975", "#8FD175"])

    // variable u: map data to existing bars
    var u = svg.selectAll("rect")
      .data(data)

    // update bars
    u
      .enter()
      .append("rect")
      .merge(u)
      .transition()
      .duration(1000)
        .attr("x", function(d) { return x(d.Country); })
        .attr("y", function(d) { return y(d[selectedVar]); })
        .attr("width", x.bandwidth())
        .attr("height", function(d) { return height - y(d[selectedVar]); })
        .attr("fill", function (d) { return color(d.Incomegroup) });

// Define the legend data
var legendData = ["Lower middle income", "Upper middle income", "High income"];

// Calculate the legend width and height
var legendWidth = 100;
var legendHeight = legendData.length * 20;

// Add a legend group
var legend = svg.append("g")
  .attr("class", "legend")
  .attr("transform", "translate(" + (width - legendWidth - 10) + ", 10)");

// Add squares and text for each legend item
var legendItems = legend.selectAll(".legend-item")
  .data(legendData)
  .enter().append("g")
  .attr("class", "legend-item")
  .attr("transform", function(d, i) {
    return "translate(0," + (i * 20) + ")";
  });

legendItems.append("rect")
  .attr("x", 5)
  .attr("y", 0)
  .attr("width", 10)
  .attr("height", 10)
  .style("fill", function(d) {
    return color(d);
  });

legendItems.append("text")
  .attr("x", 20)
  .attr("y", 9)
  .text(function(d) {
    return d;
  })
  .attr("class", "legend-text");


  });

}


 // Define the range of years
    const years = Array.from({ length: 20 }, (_, i) => 2000 + i);

    // Create a slider scale
    const sliderScale = d3.scaleLinear()
      .domain([0, years.length - 1])
      .range([0, 500])
      .clamp(true);

    // Create the slider element
    const slider = d3.select(".slider")
      .append("input")
      .attr("type", "range")
      .attr("id", "slider")
      .attr("min", 0)
      .attr("max", years.length - 1)
      .attr("step", 1)
      .style("width", "100%")
      .on("input", function () {
        const yearIndex = parseInt(this.value);
        const selectedYear = years[yearIndex];
        d3.select(".slider-value").text(selectedYear);
        update(selectedYear)
 // Update circle radius based on the slider value
    const radius = sliderScale(yearIndex) / 2000;

    // Remove any existing circles
    d3.select("#visualization").selectAll("circle").remove();

    // Draw a new circle
    d3.select("#visualization")
      .append("circle")
      .attr("class", "circle")
      .attr("cx", 400)
      .attr("cy", 200)
      .attr("r", radius);
  });

// Update the initial position of the slider handle
slider.property("value", years.indexOf(2000));
d3.select(".slider-value").text(years[years.indexOf(2000)]);



// Initialize plot
update('2000')

</script>


</html>
